# frozen_string_literal: true

# region Core

create_table :students, force: :cascade do |t|
  t.string :genron_sf_id
  t.string :name, null: false
  t.string :url, null: false
  t.integer :works_count, null: false, default: 0, limit: 2

  t.timestamps

  t.index :genron_sf_id, unique: true
end

create_table :kadais, force: :cascade do |t|
  t.integer :year, null: false, limit: 2
  t.integer :number, null: false, limit: 2
  t.string :title, null: false
  t.string :author
  t.date :kougai_deadline
  t.date :jissaku_deadline
  t.integer :works_count, null: false, default: 0, limit: 2

  t.timestamps

  t.index %i[year number], unique: true
end

create_table :works, force: :cascade do |t|
  t.bigint :kadai_id, null: false
  t.bigint :student_id, null: false

  t.string :type, null: false
  t.integer :genron_sf_id
  t.string :title, null: false
  t.string :url, null: false

  t.timestamps

  t.index %i[kadai_id type]
  t.index %i[student_id type]
  t.index %i[type genron_sf_id], unique: true
end
add_foreign_key :works, :kadais
add_foreign_key :works, :students

create_table :scores, force: :cascade do |t|
  t.bigint :jissaku_id, null: false
  t.integer :value, null: false, limit: 2

  t.timestamps

  t.index :jissaku_id, unique: true
end
add_foreign_key :scores, :works, column: :jissaku_id

# endregion

# region User

create_table :users, force: :cascade do |t|
  t.bigint :student_id, null: false
  t.bigint :twitter_id, null: false
  t.string :image_url, null: false
  t.string :twitter_screen_name, null: false
  t.datetime :last_logged_in_at, null: false

  t.timestamps

  t.index :student_id, unique: true
  t.index :twitter_id, unique: true
end
add_foreign_key :users, :students

create_table :twitter_credentials, force: :cascade do |t|
  t.bigint :user_id, null: false
  t.string :token, null: false
  t.string :secret, null: false

  t.timestamps

  t.index :user_id, unique: true
end
add_foreign_key :twitter_credentials, :users

# endregion
