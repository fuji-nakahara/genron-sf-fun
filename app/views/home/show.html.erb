<% provide :description, translate('app.description') %>

<header class="bg-light p-4 p-md-5 rounded-3 mb-3">
  <h1 class="mb-3"><span class="text-light bg-dark bg-gradient">裏</span>SF創作講座</h1>
  <p class="lead">
    <%= link_to 'ゲンロン 大森望 SF創作講座', genron_sf_url, class: 'link-dark', target: '_blank' %>
    の裏サイト（ファンサイト）。<br>
    非公式に作品に投票したり、非公式に作品を投稿したりできます。<br>
  </p>
  <p>
    <% if current_user %>
      <iframe src="https://github.com/sponsors/fuji-nakahara/button" title="Sponsor fuji-nakahara" height="35" width="116" style="border: 0;"></iframe>
    <% else %>
      <%= link_to icon('fab', 'twitter', 'Twitter でログイン'), '/auth/twitter', method: :post, class: 'btn btn-primary' %>
    <% end %>
  </p>
</header>

<section class="mb-3">
  <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3">
    <%= render @kadais %>
  </div>
</section>

<section class="mb-3">
  <ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link active" id="activity-tab" data-toggle="tab" href="#activity" role="tab" aria-controls="home" aria-selected="true">アクティビティ</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" id="ranking-tab" data-toggle="tab" href="#ranking" role="tab" aria-controls="profile" aria-selected="false">得票数ランキング</a>
    </li>
    <li class="nav-item d-none d-lg-block" role="presentation">
      <a class="nav-link" id="score-tab" data-toggle="tab" href="#score" role="tab" aria-controls="profile" aria-selected="false">得点チャート</a>
    </li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active" id="activity" role="tabpanel" aria-labelledby="activity-tab">
      <div class="list-group">
        <%= render @votes %>
      </div>
    </div>

    <div class="tab-pane fade" id="ranking" role="tabpanel" aria-labelledby="ranking-tab">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">受講生</th>
            <th scope="col">梗概</th>
            <th scope="col">実作</th>
            <th scope="col">合計</th>
          </tr>
        </thead>
        <tbody>
          <% @students.each do |student| %>
            <tr>
              <td>
                <%= link_to student.name, student, class: 'link-dark' %>
                <% if student.user %>
                  <%= link_to_twitter_profile_with_image(student.user) %>
                <% end %>
              </td>
              <td><%= student.kougai_votes_sum %></td>
              <td><%= student.jissaku_votes_sum %></td>
              <td><span class="badge rounded-pill bg-primary"><%= student.votes_sum %></span></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="tab-pane fade" id="score" role="tabpanel" aria-labelledby="score-tab">
      <canvas class="mb-2" id="score-chart" data-controller="score-chart" data-score-chart-endpoint="<%= score_path(@kadais.last.year) %>"></canvas>
      <%= link_to icon('fas', 'external-link-alt', '超・SF作家育成サイトで詳細を確認'), GenronSF::ScoreTable.build_url(year: @kadais.last.year), class: 'btn btn-outline-primary', target: '_blank' %>
    </div>
  </div>
</section>
